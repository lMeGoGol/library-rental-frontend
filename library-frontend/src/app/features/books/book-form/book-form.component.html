<section class="form-panel">
  <div class="card">
    <h2>{{ editing ? '–†–µ–¥–∞–≥—É–≤–∞—Ç–∏ –∫–Ω–∏–≥—É' : '–ù–æ–≤–∞ –∫–Ω–∏–≥–∞' }}</h2>
    <ng-container *ngIf="!loading; else loadingTpl">
  <form [formGroup]="form" (ngSubmit)="submit()" class="form-fields">
        <label class="form-field" [class.invalid]="fieldError('title')">–ù–∞–∑–≤–∞
          <input formControlName="title" /> 
          <small class="err" *ngIf="fieldError('title')">{{ fieldError('title') }}</small>
        </label>
        <label class="form-field" [class.invalid]="fieldError('author')">–ê–≤—Ç–æ—Ä
          <input formControlName="author" /> 
          <small class="err" *ngIf="fieldError('author')">{{ fieldError('author') }}</small>
        </label>
        <label class="form-field" [class.invalid]="fieldError('genre')">–ñ–∞–Ω—Ä
          <select formControlName="genre" class="input">
            <option value="" disabled>‚Äî –æ–±–µ—Ä—ñ—Ç—å –∂–∞–Ω—Ä ‚Äî</option>
            <option *ngFor="let g of genres" [value]="g">{{ g }}</option>
          </select>
          <small class="err" *ngIf="fieldError('genre')">{{ fieldError('genre') }}</small>
        </label>
        <div class="row">
          <label class="form-field flex-1" [class.invalid]="fieldError('rentPrice')">–û—Ä–µ–Ω–¥–∞/–¥–µ–Ω—å
            <input type="number" formControlName="rentPrice" min="0" placeholder="–≤–∫–∞–∂—ñ—Ç—å —Å—É–º—É –∑–∞ 1 –¥–µ–Ω—å (‚Ç¥)" /> 
            <small class="muted" *ngIf="!fieldError('rentPrice')">–¶—ñ–Ω–∞ –∑–∞ 1 –¥–µ–Ω—å –æ—Ä–µ–Ω–¥–∏ (‚Ç¥)</small>
            <small class="err" *ngIf="fieldError('rentPrice')">{{ fieldError('rentPrice') }}</small>
          </label>
          <label class="form-field flex-1" [class.invalid]="fieldError('deposit')">–ó–∞—Å—Ç–∞–≤–∞
            <input type="number" formControlName="deposit" min="0" placeholder="—Å—É–º–∞ –∑–∞—Å—Ç–∞–≤–∏ (‚Ç¥)" /> 
            <small class="muted" *ngIf="!fieldError('deposit')">–°—É–º–∞ –∑–∞—Å—Ç–∞–≤–∏ —É –≥—Ä–∏–≤–Ω—è—Ö</small>
            <small class="err" *ngIf="fieldError('deposit')">{{ fieldError('deposit') }}</small>
          </label>
        </div>
        <div class="form-field">
          <label>–ú—ñ–Ω—ñ–∞—Ç—é—Ä–∞ (–æ–±–∫–ª–∞–¥–∏–Ω–∫–∞)
            <input type="file" accept="image/*" (change)="onFileSelected($event)" />
          </label>
          <div *ngIf="previewUrl" class="preview">
            <img [src]="previewUrl" alt="preview" class="preview-img" (error)="previewUrl=null" />
            <small class="muted" *ngIf="form.value.thumbnailUrl">URL: {{ form.value.thumbnailUrl }}</small>
            <span class="badge" *ngIf="!form.value.thumbnailUrl">–ª–æ–∫–∞–ª—å–Ω–∏–π –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–π –ø–µ—Ä–µ–≥–ª—è–¥</span>
          </div>
        </div>
        <label class="switch-field">
          <span class="switch-label">–î–æ—Å—Ç—É–ø–Ω–∞</span>
          <input class="switch-input" type="checkbox" formControlName="available" />
          <span class="switch-ui" aria-hidden="true"></span>
        </label>
        <div class="actions">
          <button class="btn btn-save-accent" type="submit" [disabled]="form.invalid">üíæ –ó–±–µ—Ä–µ–≥—Ç–∏</button>
          <button type="button" class="btn outline" (click)="goBack()">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
          <button *ngIf="editing" type="button" class="btn danger ml-auto" (click)="confirmDelete()">üóëÔ∏è –í–∏–¥–∞–ª–∏—Ç–∏</button>
        </div>
      </form>
    </ng-container>
    <ng-template #loadingTpl>
      <div class="muted">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</div>
    </ng-template>
  </div>
</section>
