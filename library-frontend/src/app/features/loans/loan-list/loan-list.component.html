<section>
  <div class="section-title">üìÇ –ü–æ–∑–∏–∫–∏</div>
  <div class="card filters-bar">
    <div class="filters-title">–§—ñ–ª—å—Ç—Ä–∏</div>
    <div class="filters-grid">
      <div class="fg">
        <label>–°—Ç–∞—Ç—É—Å</label>
        <select class="input small" (change)="setStatus(($any($event.target)).value)" [value]="status">
          <option value="all">–≤—Å—ñ</option>
          <option value="issued">–≤–∏–¥–∞–Ω–æ</option>
          <option value="returned">–ø–æ–≤–µ—Ä–Ω–µ–Ω–æ</option>
        </select>
      </div>
      <div class="fg">
        <label>–°–æ—Ä—Ç—É–≤–∞–Ω–Ω—è</label>
        <div class="inline">
          <select class="input small" [value]="sortBy" (change)="setSort(($any($event.target)).value)">
            <option value="issueDate">–í–∏–¥–∞–Ω–æ</option>
            <option value="expectedReturnDate">–û—á—ñ–∫—É—î—Ç—å—Å—è</option>
            <option value="status">–°—Ç–∞—Ç—É—Å</option>
          </select>
          <button class="btn icon outline" (click)="toggleDir()" title="–ó–º—ñ–Ω–∏—Ç–∏ –Ω–∞–ø—Ä—è–º–æ–∫">{{ sortDir==='asc' ? '‚¨Ü' : '‚¨á' }}</button>
        </div>
      </div>
      <div class="fg">
        <label>–ü—Ä–æ—Å—Ç—Ä–æ—á–µ–Ω—ñ</label>
        <label class="inline">
          <input type="checkbox" [checked]="overdueMode" (change)="toggleOverdue()" />
          <span>–ª–∏—à–µ –ø—Ä–æ—Å—Ç—Ä–æ—á–µ–Ω—ñ</span>
        </label>
      </div>

      <div class="fg">
        <label>Reader ID</label>
        <input class="input small" type="text" placeholder="readerId" [(ngModel)]="filterReaderId" />
      </div>
      <div class="fg">
        <label>Book ID</label>
        <input class="input small" type="text" placeholder="bookId" [(ngModel)]="filterBookId" />
      </div>
      <div class="fg actions-right">
        <label>&nbsp;</label>
        <div class="inline">
          <button class="btn search" (click)="applyFilters()">üîé –ü–æ—à—É–∫</button>
          <button class="btn outline" (click)="clearFilters()" [disabled]="!filterReaderId && !filterBookId">–û—á–∏—Å—Ç–∏—Ç–∏</button>
          <!-- –†–µ–∑–µ—Ä–≤–∏ –∫–Ω–æ–ø–∫–∞ –≤–∏–¥–∞–ª–µ–Ω–∞ (–æ–∫—Ä–µ–º–µ –º–µ–Ω—é) -->
        </div>
      </div>
    </div>
  </div>
  <div *ngIf="loading" class="card loading">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</div>
  <div *ngIf="!loading && loans.length" class="card card-table">
    <div class="table-scroll-x">
    <table class="lib-table no-margin">
      <thead>
        <tr>
          <th>ID</th>
          <th>ID –∫–Ω–∏–≥–∏</th>
          <th>–ö–Ω–∏–≥–∞</th>
          <th>–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á</th>
          <th>–í–∏–¥–∞–Ω–æ</th>
          <th>–ü–æ–≤–µ—Ä–Ω—É—Ç–æ</th>
          <th>–°—Ç–∞—Ç—É—Å</th>
          <th class="actions-col">–î—ñ—ó</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let l of loans">
          <td class="id-col">
            <div class="id-cell">
              <span class="mono" [title]="l.id">{{ formatId(l.id) }}</span>
              <button class="btn tiny outline" title="–ö–æ–ø—ñ—é–≤–∞—Ç–∏ ID" (click)="copyId($event, l.id)">üìã</button>
            </div>
          </td>
          <td class="id-col">
            <div class="id-cell">
              <span class="mono" [title]="getBookId(l.book)">{{ formatId(getBookId(l.book)) }}</span>
              <button class="btn tiny outline" title="–ö–æ–ø—ñ—é–≤–∞—Ç–∏ ID –∫–Ω–∏–≥–∏" (click)="copyId($event, getBookId(l.book))">üìã</button>
            </div>
          </td>
          <td>{{ l.book | bookTitle }}</td>
          <td>
            <a *ngIf="l.reader && typeof l.reader!=='string'" [routerLink]="['/users', l.reader.id, 'profile']" class="user-link">{{ l.reader.username }}</a>
            <span *ngIf="!l.reader || typeof l.reader==='string'">{{ l.reader | userName }}</span>
          </td>
          <td>{{ l.issueDate | date:'shortDate' }}</td>
          <td>{{ l.actualReturnDate ? (l.actualReturnDate | date:'shortDate') : '‚Äî' }}</td>
          <td>
            <span class="badge" [class.success]="l.status==='returned'" [class.warn]="l.status==='issued'">
              {{ l.status === 'issued' ? '–≤–∏–¥–∞–Ω–æ' : (l.status === 'returned' ? '–ø–æ–≤–µ—Ä–Ω–µ–Ω–æ' : l.status) }}
            </span>
          </td>
          <td class="actions">
      <button class="btn action-return" *ngIf="l.status === 'issued'" (click)="returnLoan(l)">‚Ü©Ô∏è –ü–æ–≤–µ—Ä–Ω—É—Ç–∏</button>
      <button class="btn action-renew" *ngIf="l.status === 'issued'" (click)="renew(l)">‚è© –ü—Ä–æ–¥–æ–≤–∂–∏—Ç–∏</button>
          </td>
        </tr>
      </tbody>
    </table>
    </div>
  <app-pager [page]="page" [limit]="limit" [length]="loans.length" (prev)="prevPage()" (next)="nextPage()" />
  </div>
  <div *ngIf="!loading && !loans.length" class="card empty">–ù–µ–º–∞—î –ø–æ–∑–∏–∫</div>
</section>
