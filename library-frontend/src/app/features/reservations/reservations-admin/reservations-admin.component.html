<section class="card">
  <h2 class="mt-0">üîî –†–µ–∑–µ—Ä–≤–∏</h2>
  <div class="toolbar mb-10">
    <label>–°—Ç–∞—Ç—É—Å:
      <select (change)="setStatus(($any($event.target)).value)" [value]="status">
        <option value="pending">–æ—á—ñ–∫—É—î</option>
        <option value="fulfilled">–≤–∏–∫–æ–Ω–∞–Ω–æ</option>
        <option value="cancelled">—Å–∫–∞—Å–æ–≤–∞–Ω–æ</option>
        <option value="">—É—Å—ñ</option>
      </select>
    </label>
  </div>
  <div *ngIf="loading">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è‚Ä¶</div>
  <div *ngIf="!loading && !reservations.length" class="muted">–ù–µ–º–∞—î —Ä–µ–∑–µ—Ä–≤—ñ–≤</div>
  <div *ngIf="!loading && reservations.length" class="table-wrap">
    <table class="lib-table">
      <thead>
        <tr>
          <th>ID</th>
          <th>–ö–Ω–∏–≥–∞</th>
          <th>–ß–∏—Ç–∞—á</th>
          <th>–î–Ω—ñ</th>
          <th>–°—Ç–∞—Ç—É—Å</th>
          <th>–°—Ç–≤–æ—Ä–µ–Ω–æ</th>
          <th>–î—ñ—ó</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let r of reservations; trackBy: trackById">
          <td class="mono" [title]="r.id">{{ r.id.slice(-6) }}</td>
          <td>{{ bookTitle(r) }}</td>
          <td>
            <a [routerLink]="['/users', (typeof r.reader==='string'? r.reader : r.reader.id), 'profile']" class="user-link">
              {{ userName(r) }}
            </a>
          </td>
          <td>{{ r.desiredDays }}</td>
          <td><span class="badge" [class.warn]="r.status==='pending'" [class.success]="r.status==='fulfilled'" [class.danger]="r.status==='cancelled'">{{ r.status==='pending' ? '–æ—á—ñ–∫—É—î' : (r.status==='fulfilled' ? '–≤–∏–∫–æ–Ω–∞–Ω–æ' : '—Å–∫–∞—Å–æ–≤–∞–Ω–æ') }}</span></td>
          <td>{{ r.createdAt | date:'short' }}</td>
          <td class="row-actions">
            <button class="btn compact" (click)="issue(r)" [disabled]="r.status!=='pending'">–í–∏–¥–∞—Ç–∏</button>
            <button class="btn outline compact" (click)="openCancel(r)" [disabled]="r.status!=='pending'">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
          </td>
        </tr>
      </tbody>
    </table>
    <div class="pager mt-05">
      <button class="btn outline" (click)="prev()" [disabled]="page<=1">‚óÄ</button>
      <span>–°—Ç–æ—Ä. {{page}} / {{pages}}</span>
      <button class="btn outline" (click)="next()" [disabled]="page>=pages">‚ñ∂</button>
    </div>
  </div>

  <div class="modal-backdrop" *ngIf="showCancel">
    <div class="modal">
      <h3 class="mt-0">–°–∫–∞—Å—É–≤–∞–Ω–Ω—è —Ä–µ–∑–µ—Ä–≤—É</h3>
      <p class="small muted">–û–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ –≤–∫–∞–∂—ñ—Ç—å –ø—Ä–∏—á–∏–Ω—É:</p>
      <textarea class="input" rows="3" [(ngModel)]="cancelReason" placeholder="–ü—Ä–∏—á–∏–Ω–∞ (–Ω–µ–æ–±–æ–≤ º—è–∑–∫–æ–≤–æ)"></textarea>
      <div class="row mt-10">
        <button class="btn" (click)="confirmCancel()">–ü—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏</button>
        <button class="btn outline" (click)="closeCancel()">–í—ñ–¥–º—ñ–Ω–∏—Ç–∏</button>
      </div>
    </div>
  </div>
</section>
