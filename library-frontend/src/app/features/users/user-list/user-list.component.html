<section class="users-page">
  <div>
  <div class="section-title">üë• –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ</div>
  <div class="card">
    <div class="toolbar">
      <input #search class="input" type="text" placeholder="–ü–æ—à—É–∫..." (input)="onSearch(search.value)" />
      <select #roleSel class="input" (change)="onRoleFilterChange(roleSel.value)" *ngIf="viewerRole==='admin'">
        <option value="">–í—Å—ñ —Ä–æ–ª—ñ</option>
        <option value="admin">–∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä</option>
        <option value="librarian">–±—ñ–±–ª—ñ–æ—Ç–µ–∫–∞—Ä</option>
        <option value="reader">—á–∏—Ç–∞—á</option>
      </select>
    </div>
  
  <div *ngIf="loading" class="loading">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</div>
  <div *ngIf="!loading && error" class="empty error-text">{{ error }}</div>
  <table *ngIf="!loading && users.length" class="lib-table">
      <thead>
        <tr>
  <th class="id-col">ID</th>
      <th>–õ–æ–≥—ñ–Ω</th>
      <th>–†–æ–ª—å</th>
      <th>–ó–Ω–∏–∂–∫–∞</th>
        </tr>
      </thead>
      <tbody>
  <tr class="row-click" *ngFor="let u of users; trackBy: trackById" (click)="select(u)">
      <td class="id-col">
        <div class="id-cell">
          <span class="mono short-id" [title]="u.id">‚Ä¶{{ u.id.slice(-5) }}</span>
          <button class="btn compact" title="–ö–æ–ø—ñ—é–≤–∞—Ç–∏ ID" (click)="$event.stopPropagation(); copyId(u.id)">üìã</button>
        </div>
      </td>
  <td><a [routerLink]="['/users', u.id, 'profile']" class="user-link" (click)="$event.stopPropagation()">{{ u.username }}</a></td>
      <td>{{ u.role === 'admin' ? '–∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä' : (u.role === 'librarian' ? '–±—ñ–±–ª—ñ–æ—Ç–µ–∫–∞—Ä' : '—á–∏—Ç–∞—á') }}</td>
      <td>{{ u.discountCategory === 'student' ? '—Å—Ç—É–¥–µ–Ω—Ç' : (u.discountCategory === 'loyal' ? '–ª–æ—è–ª—å–Ω–∏–π' : (u.discountCategory === 'pensioner' ? '–ø–µ–Ω—Å—ñ–æ–Ω–µ—Ä' : (u.discountCategory === 'vip' ? 'VIP' : '–±–µ–∑ –∑–Ω–∏–∂–∫–∏'))) }}</td>
        </tr>
      </tbody>
    </table>
    <div *ngIf="!loading && !users.length" class="empty">–ù–µ–º–∞—î –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤</div>
    <div class="pager">
      <button class="btn outline" (click)="prev()" [disabled]="page<=1">–ü–æ–ø–µ—Ä–µ–¥–Ω—è</button>
      <span>–°—Ç–æ—Ä—ñ–Ω–∫–∞ {{page}} / {{pages}}</span>
      <button class="btn outline" (click)="next()" [disabled]="page>=pages">–ù–∞—Å—Ç—É–ø–Ω–∞</button>
    </div>
  </div>
  </div>

  <div class="card editor-card">
    <ng-container *ngIf="selected; else noSelection">
  <h3>–î–∞–Ω—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞</h3>
      <div class="editor-grid">
  <label>–Ü–º º—è<input class="input" [(ngModel)]="firstNameDraft" placeholder="–Ü–º º—è" /></label>
  <label>–ü—Ä—ñ–∑–≤–∏—â–µ<input class="input" [(ngModel)]="lastNameDraft" placeholder="–ü—Ä—ñ–∑–≤–∏—â–µ" /></label>
        <label>–ü–æ-–±–∞—Ç—å–∫–æ–≤—ñ<input class="input" [(ngModel)]="middleNameDraft" placeholder="–ü–æ-–±–∞—Ç—å–∫–æ–≤—ñ" /></label>
        <label>–¢–µ–ª–µ—Ñ–æ–Ω<input class="input" [(ngModel)]="phoneDraft" placeholder="+380..." /></label>
  <label class="full">–ê–¥—Ä–µ—Å–∞<input class="input" [(ngModel)]="addressDraft" placeholder="–ê–¥—Ä–µ—Å–∞" /></label>
      </div>
      <div class="mt-sm row-inline" *ngIf="viewerRole==='admin' && selected"><strong>–†–æ–ª—å:</strong>
        <span>{{ selected.role === 'admin' ? '–∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä' : (selected.role === 'librarian' ? '–±—ñ–±–ª—ñ–æ—Ç–µ–∫–∞—Ä' : '—á–∏—Ç–∞—á') }}</span>
      </div>
      <div class="mt-sm row-inline" *ngIf="roleDraft==='reader'"><strong>–ö–∞—Ç–µ–≥–æ—Ä—ñ—è –∑–Ω–∏–∂–∫–∏:</strong>
        <select class="input compact" [(ngModel)]="discountDraft">
          <option value="none">–±–µ–∑ –∑–Ω–∏–∂–∫–∏</option>
          <option value="student">—Å—Ç—É–¥–µ–Ω—Ç</option>
          <option value="loyal">–ª–æ—è–ª—å–Ω–∏–π</option>
          <option value="pensioner">–ø–µ–Ω—Å—ñ–æ–Ω–µ—Ä</option>
          <option value="vip">VIP</option>
        </select>
        <button class="btn primary" (click)="saveDiscount()">–ó–±–µ—Ä–µ–≥—Ç–∏</button>
        <span class="saved" *ngIf="savedDiscount">–ó–±–µ—Ä–µ–∂–µ–Ω–æ ‚úì</span>
      </div>
      <div class="mt-sm row-tools">
        <button class="btn primary" (click)="saveProfile()">–ó–±–µ—Ä–µ–≥—Ç–∏ –ø—Ä–æ—Ñ—ñ–ª—å</button>
        <span class="saved" *ngIf="savedProfile">–ó–±–µ—Ä–µ–∂–µ–Ω–æ ‚úì</span>
  <button class="btn outline" type="button" (click)="closeEditor()">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
        <a *ngIf="selected" class="btn outline ml-auto" [routerLink]="['/users', selected.id, 'profile']">–Ü—Å—Ç–æ—Ä—ñ—è –∑–≤–µ—Ä–Ω–µ–Ω—å</a>
      </div>
      
    </ng-container>
    <ng-template #noSelection>
      <div class="empty">–û–±–µ—Ä—ñ—Ç—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –ª—ñ–≤–æ—Ä—É—á –¥–ª—è —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è</div>
    </ng-template>
  </div>
</section>
